{
  "$schema": "http://json-schema.org/draft-07/schema",
  "title": "页面配置",
  "description": "支持表格、表单、列表、树等",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string"
    },
    "apis": {
      "title": "接口列表",
      "description": "APP配置从服务端获取接口列表时，此处配置失效",
      "type": "object"
    },
    "table": {
      "title": "右侧表格",
      "description": "",
      "$ref": "#table"
    },
    "navs": {
      "title": "左侧导航",
      "description": "导航列表或导航树",
      "type": "array",
      "uniqueItems": true,
      "minItems": 1,
      "items": {
        "anyOf": [
          {
            "$ref": "#list"
          },
          {
            "$ref": "#tree"
          }
        ]
      }
    }
  },
  "required": [
    "table"
  ],
  "definitions": {
    "table": {
      "$id": "#table",
      "title": "表格配置",
      "type": "object",
      "required": [
        "view"
      ],
      "additionalProperties": false,
      "properties": {
        "name": {
          "title": "表格名称",
          "type": "string",
          "minLength": 1
        },
        "key": {
          "title": "数据主键",
          "type": "string",
          "default": "id",
          "minLength": 1
        },
        "view": {
          "title": "表格视图配置",
          "type": "object",
          "required": [
            "api",
            "columns"
          ],
          "additionalProperties": false,
          "properties": {
            "api": {
              "$id": "#api",
              "title": "接口地址",
              "description": "查询表格数据的接口地址",
              "type": "string",
              "pattern": "^apis.[a-zA-Z]+$"
            },
            "body": {
              "title": "接口参数",
              "description": "用户自定义的接口参数",
              "type": "object",
              "examples": [
                {
                  "roleId": "$this.list.id$"
                }
              ]
            },
            "pageSize": {
              "title": "每页显示条数",
              "type": "integer",
              "default": 10,
              "multipleOf": 5,
              "minimum": 5
            },
            "frontPagination": {
              "title": "是否前端分页",
              "type": "boolean",
              "default": false
            },
            "parseData": {
              "$id": "#parseData",
              "title": "解析数据",
              "description": "表格渲染之前对数据进行处理",
              "type": "string",
              "pattern": "^d=>.+",
              "examples": [
                "d=>d.name=d.firstName+d.lastName",
                "d=>{d.name=d.fullName;d.age=18}"
              ]
            },
            "columns": {
              "title": "表格列",
              "description": "表格每列显示配置",
              "type": "array",
              "uniqueItems": true,
              "minItems": 1,
              "items": {
                "type": "object",
                "required": [
                  "label",
                  "key"
                ],
                "additionalProperties": false,
                "properties": {
                  "label": {
                    "title": "表格表头文字",
                    "type": "string",
                    "minLength": 1
                  },
                  "key": {
                    "title": "表格数据字段",
                    "type": "string",
                    "minLength": 1
                  },
                  "search": {
                    "title": "是否可搜索",
                    "description": "当前字段是否支持搜索",
                    "type": "boolean",
                    "default": false
                  },
                  "icon": {
                    "title": "显示图标",
                    "type": "string"
                  },
                  "color": {
                    "title": "显示颜色",
                    "enum": [
                      "default",
                      "green",
                      "blue",
                      "yellow",
                      "orange",
                      "red"
                    ],
                    "default": "default"
                  }
                }
              }
            }
          }
        },
        "form": {
          "$ref": "#form"
        },
        "create": {
          "title": "新增接口",
          "type": "object",
          "required": [
            "api"
          ],
          "additionalProperties": false,
          "properties": {
            "api": {
              "title": "新增接口地址",
              "$ref": "#api"
            },
            "body": {
              "title": "接口参数",
              "description": "用户自定义的接口参数",
              "type": "object",
              "examples": [
                {
                  "roleId": "$this.list.id$"
                }
              ]
            }
          }
        },
        "update": {
          "title": "修改接口",
          "type": "object",
          "required": [
            "api"
          ],
          "additionalProperties": false,
          "properties": {
            "api": {
              "title": "修改接口地址",
              "$ref": "#api"
            },
            "body": {
              "title": "接口参数",
              "description": "用户自定义的接口参数",
              "type": "object",
              "examples": [
                {
                  "roleId": "$this.list.id$"
                }
              ]
            },
            "name": {
              "default": "修改"
            }
          }
        },
        "delete": {
          "title": "删除接口",
          "type": "object",
          "required": [
            "api"
          ],
          "additionalProperties": false,
          "properties": {
            "api": {
              "description": "删除接口地址",
              "$ref": "#api"
            },
            "body": {
              "title": "接口参数",
              "description": "用户自定义的接口参数",
              "type": "object",
              "default": {
                "ids": [
                  "$this.data[this.key]$"
                ]
              }
            },
            "name": {
              "default": "删除"
            }
          }
        }
      },
      "dependencies": {
        "create": [
          "update",
          "form"
        ],
        "update": [
          "create",
          "form"
        ],
        "form": [
          "create",
          "update"
        ]
      }
    },
    "form": {
      "$id": "#form",
      "title": "表单配置",
      "description": "可配置多个表单",
      "type": "array",
      "uniqueItems": true,
      "minItems": 1,
      "items": {
        "title": "表单配置项",
        "description": "width、cols如需配置，请在第一个表单里配置",
        "type": "object",
        "required": [
          "fields"
        ],
        "additionalProperties": false,
        "properties": {
          "name": {
            "title": "表单名称",
            "type": "string",
            "minLength": 1
          },
          "width": {
            "title": "表单宽度",
            "oneOf": [
              {
                "enum": [
                  360,
                  560,
                  720,
                  960
                ]
              }
            ]
          },
          "cols": {
            "title": "表单列数",
            "enum": [
              1,
              2,
              3,
              4,
              6
            ],
            "default": 1
          },
          "tip": {
            "title": "表单说明提示",
            "type": "string",
            "minLength": 1
          },
          "beforeOpen": {
            "title": "表单编辑前数据处理",
            "$ref": "#parseData"
          },
          "beforeSave": {
            "title": "表单保存前数据处理",
            "$ref": "#parseData"
          },
          "fields": {
            "description": "表单字段",
            "type": "array",
            "uniqueItems": true,
            "minItems": 1,
            "items": {
              "title": "表单字段属性设置",
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "type": {
                  "title": "表单项类型",
                  "enum": [
                    "input",
                    "textarea",
                    "number",
                    "password",
                    "switch",
                    "select",
                    "modal",
                    "datetime",
                    "date",
                    "time"
                  ]
                },
                "label": {
                  "title": "表单项标签",
                  "type": "string",
                  "minLength": 1
                },
                "key": {
                  "title": "表单项数据字段",
                  "type": "string",
                  "minLength": 1
                },
                "value": {
                  "title": "表单项默认值",
                  "type": [
                    "string",
                    "number"
                  ],
                  "minLength": 1
                },
                "span": {
                  "title": "表单项跨度",
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 24
                },
                "required": {
                  "title": "表单项是否必填",
                  "type": "boolean",
                  "default": false
                },
                "readonly": {
                  "title": "表单项是否只读",
                  "description": "可通过数据内容来确定是否只读",
                  "type": [
                    "boolean",
                    "string"
                  ],
                  "examples": [
                    "d=>d.status===0",
                    "d=>{return d.status===0}"
                  ],
                  "default": false
                },
                "tip": {
                  "title": "表单项说明提示",
                  "type": "string",
                  "minLength": 1
                }
              },
              "allOf": [
                {
                  "if": {
                    "properties": {
                      "type": {
                        "enum": [
                          "input",
                          "password",
                          "textarea"
                        ]
                      }
                    }
                  },
                  "then": {
                    "properties": {
                      "input": {
                        "title": "普通输入框专属配置",
                        "type": "object",
                        "default": {},
                        "additionalProperties": false,
                        "properties": {
                          "minLength": {
                            "title": "最小输入文字数量",
                            "type": "integer",
                            "default": 1
                          },
                          "maxLength": {
                            "title": "最大输入文字数量",
                            "type": "integer",
                            "default": 32
                          }
                        }
                      },
                      "pattern": {
                        "title": "内置正则校验",
                        "oneOf": [
                          {
                            "enum": [
                              "字母",
                              "数字",
                              "汉字",
                              "身份证",
                              "手机号",
                              "邮箱"
                            ]
                          },
                          {
                            "title": "自定义正则校验",
                            "type": "object",
                            "required": [
                              "name",
                              "reg"
                            ],
                            "additionalProperties": false,
                            "properties": {
                              "name": {
                                "title": "正则表达式名称",
                                "type": "string",
                                "minLength": 1
                              },
                              "reg": {
                                "title": "正则表达式",
                                "type": "string",
                                "minLength": 1
                              }
                            }
                          }
                        ]
                      }
                    }
                  }
                },
                {
                  "if": {
                    "properties": {
                      "type": {
                        "const": "textarea"
                      }
                    }
                  },
                  "then": {
                    "properties": {
                      "input": {
                        "default": {
                          "maxLength": 128
                        }
                      }
                    }
                  }
                },
                {
                  "if": {
                    "properties": {
                      "type": {
                        "const": "number"
                      }
                    }
                  },
                  "then": {
                    "properties": {
                      "number": {
                        "title": "数字输入框专属配置",
                        "type": "object",
                        "default": {},
                        "additionalProperties": false,
                        "properties": {
                          "min": {
                            "title": "最小输入数字",
                            "type": "integer",
                            "default": -9007199254740991
                          },
                          "max": {
                            "title": "最大输入数字",
                            "type": "integer",
                            "default": 9007199254740991
                          }
                        }
                      }
                    }
                  }
                },
                {
                  "if": {
                    "properties": {
                      "type": {
                        "const": "select"
                      }
                    }
                  },
                  "then": {
                    "required": [
                      "select"
                    ],
                    "properties": {
                      "select": {
                        "title": "下拉选择框专属配置",
                        "type": "object",
                        "additionalProperties": false,
                        "properties": {
                          "multiple": {
                            "title": "是否多选",
                            "type": "boolean",
                            "default": false
                          }
                        },
                        "oneOf": [
                          {
                            "required": [
                              "options"
                            ],
                            "additionalProperties": false,
                            "properties": {
                              "options": {
                                "title": "固定选项数据",
                                "type": "array",
                                "uniqueItems": true,
                                "default": [],
                                "items": {
                                  "type": "object",
                                  "required": [
                                    "label",
                                    "value"
                                  ],
                                  "additionalProperties": false,
                                  "properties": {
                                    "label": {
                                      "title": "选项显示的标签",
                                      "type": "string"
                                    },
                                    "value": {
                                      "title": "选项提交到后台的值",
                                      "type": [
                                        "string",
                                        "number"
                                      ]
                                    }
                                  }
                                }
                              }
                            }
                          },
                          {
                            "required": [
                              "api",
                              "labelKey"
                            ],
                            "additionalProperties": false,
                            "properties": {
                              "api": {
                                "title": "服务接口地址",
                                "$ref": "#api"
                              },
                              "labelKey": {
                                "title": "用于展示的字段",
                                "type": "string",
                                "minLength": 1
                              },
                              "valueKey": {
                                "title": "用于关联的字段",
                                "type": "string",
                                "minLength": 1,
                                "default": "id"
                              }
                            }
                          }
                        ]
                      }
                    }
                  }
                },
                {
                  "if": {
                    "properties": {
                      "type": {
                        "const": "modal"
                      }
                    }
                  },
                  "then": {
                    "required": [
                      "modal"
                    ],
                    "properties": {
                      "modal": {
                        "oneOf": [
                          {
                            "$ref": "#table"
                          }
                        ]
                      }
                    }
                  }
                },
                {
                  "if": {},
                  "then": {
                    "required": [
                      "type",
                      "label",
                      "key"
                    ]
                  }
                }
              ]
            }
          }
        }
      }
    },
    "list": {
      "$id": "#list",
      "title": "列表配置",
      "description": "列表配置",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "key": {
          "title": "数据主建",
          "type": "string",
          "default": "id",
          "minLength": 1
        }
      }
    },
    "tree": {
      "$id": "#tree",
      "title": "树配置",
      "description": "树配置",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "key": {
          "title": "数据主建",
          "type": "string",
          "default": "id",
          "minLength": 1
        }
      }
    }
  }
}
